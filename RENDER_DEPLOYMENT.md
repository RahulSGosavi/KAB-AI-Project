# üöÄ Render Deployment Guide - AI Interior Design Platform

Complete step-by-step guide to deploy your Flask application on Render.

---

## üìã Prerequisites

Before you begin, make sure you have:
- ‚úÖ GitHub account with your code pushed
- ‚úÖ Render account (sign up at https://render.com)
- ‚úÖ OpenAI API key (optional, for AI Q&A features)

---

## üöÄ Quick Deployment (5 Minutes)

### **Step 1: Connect to Render**

1. Go to **https://render.com**
2. Click **"Get Started for Free"** or **"Sign Up"**
3. Choose **"Sign up with GitHub"**
4. Authorize Render to access your GitHub repositories

### **Step 2: Create New Web Service**

1. In your Render dashboard, click **"New +"**
2. Select **"Web Service"**
3. Choose **"Build and deploy from a Git repository"**
4. Select your repository: **`ai-interior-design-flask`**
5. Click **"Connect"**

### **Step 3: Configure Your Service**

Fill in the following details:

**Basic Settings:**
- **Name**: `ai-interior-design` (or your preferred name)
- **Environment**: `Python 3`
- **Region**: Choose closest to your users
- **Branch**: `main` (or your default branch)

**Build & Deploy:**
- **Build Command**: `npm install && npm run build`
- **Start Command**: `gunicorn app:app`

**Advanced Settings:**
- **Python Version**: `3.11.6`
- **Health Check Path**: `/api/health`

### **Step 4: Add PostgreSQL Database**

1. In your Render dashboard, click **"New +"**
2. Select **"PostgreSQL"**
3. Configure:
   - **Name**: `ai-interior-design-db`
   - **Database**: `interior_design`
   - **User**: `interior_design_user`
   - **Plan**: `Starter` (Free tier)
4. Click **"Create Database"**

### **Step 5: Configure Environment Variables**

In your web service settings, go to **"Environment"** tab and add:

```bash
# Required Variables
SECRET_KEY=your-super-secret-key-at-least-32-chars-long
JWT_SECRET_KEY=your-jwt-secret-key-at-least-32-chars-long
FLASK_ENV=production

# Database (Auto-generated by Render)
DATABASE_URL=postgresql://interior_design_user:password@host:5432/interior_design

# Optional - For AI Q&A Features
OPENAI_API_KEY=sk-proj-YOUR_ACTUAL_OPENAI_API_KEY
```

**üîê Generate secure keys:**
```python
# Run this in Python to generate secure keys:
import secrets
print(secrets.token_hex(32))  # Run twice for both keys
```

### **Step 6: Deploy!**

1. Click **"Create Web Service"**
2. Render will automatically:
   - Install Node.js dependencies
   - Build your React frontend
   - Install Python dependencies
   - Start your Flask application
3. Wait 3-5 minutes for deployment to complete
4. Click **"View Logs"** to monitor progress

### **Step 7: Get Your Public URL**

1. Once deployed, you'll see your service URL
2. It will be: `https://your-app-name.onrender.com`
3. Open it in your browser! üéâ

---

## ‚úÖ Verify Deployment

### **Test the Health Endpoint**
```bash
curl https://your-app-name.onrender.com/api/health
```

Should return:
```json
{
  "status": "ok",
  "environment": "production"
}
```

### **Test Login**
1. Go to your Render URL
2. Try logging in with:
   - Email: `demo@example.com`
   - Password: `demo123`

---

## üîß Configuration Details

### **Files Created for Render**

1. **`render.yaml`** - Render-specific configuration
   ```yaml
   services:
     - type: web
       name: ai-interior-design
       env: python
       buildCommand: npm install && npm run build
       startCommand: gunicorn app:app
       plan: starter
   ```

2. **`Procfile`** - Already exists, tells Render how to run your app
   ```
   web: gunicorn app:app
   ```

3. **`runtime.txt`** - Specifies Python version
   ```
   python-3.11.6
   ```

4. **`requirements.txt`** - Contains all Python dependencies
   - Includes `gunicorn` for production server
   - Includes `psycopg2-binary` for PostgreSQL

### **App Configuration**

Your `app.py` handles:
- ‚úÖ Render's `PORT` environment variable
- ‚úÖ PostgreSQL URL conversion (`postgres://` ‚Üí `postgresql://`)
- ‚úÖ Production vs development mode detection
- ‚úÖ Secure defaults for secret keys

---

## üóÑÔ∏è Database Management

### **Access Database**
Render provides a PostgreSQL database with:
- Automatic backups
- SSL connections
- High availability

### **View Database**
1. Click on the **PostgreSQL** service in Render
2. Go to **"Data"** tab to browse tables
3. Or use **"Connect"** tab to get connection strings

### **Run Migrations**
If you need to run database commands:
```bash
# Render CLI (optional)
render run python
>>> from app import app, db
>>> with app.app_context():
...     db.create_all()
```

---

## üìÇ File Uploads

### **Important: Render Uses Ephemeral Storage**

Render's file system is **ephemeral**, meaning uploaded files will be lost on restart.

### **Solutions:**

#### **Option 1: Use Render Disks (Recommended)**
1. Go to your service settings
2. Add a disk mount: `/opt/render/project/src/static/uploads`
3. This persists files across deployments

#### **Option 2: Use Cloud Storage (Best for Production)**
Integrate with:
- **AWS S3**
- **Cloudinary**
- **Google Cloud Storage**
- **Azure Blob Storage**

Example with Cloudinary:
```python
# Update routes/projects.py to use Cloudinary
import cloudinary
import cloudinary.uploader

# Upload file
result = cloudinary.uploader.upload(file)
file_url = result['secure_url']
```

---

## üîê Environment Variables Reference

| Variable | Required | Default | Description |
|----------|----------|---------|-------------|
| `PORT` | Auto-set | 5000 | Render assigns this automatically |
| `DATABASE_URL` | Auto-set | sqlite | Render PostgreSQL connection string |
| `SECRET_KEY` | **Yes** | None | Flask session encryption key |
| `JWT_SECRET_KEY` | **Yes** | None | JWT token signing key |
| `FLASK_ENV` | Recommended | development | Set to `production` |
| `OPENAI_API_KEY` | Optional | None | For AI Q&A features |
| `MAX_CONTENT_LENGTH` | Optional | 52428800 | Max upload size (50MB) |

---

## üìä Monitoring & Logs

### **View Real-Time Logs**
1. Click on your web service
2. Go to **"Logs"** tab
3. Watch deployment and runtime logs

### **Common Log Messages**
```
‚úì Demo user created: demo@example.com / demo123
‚úì Running on http://0.0.0.0:PORT
‚úì Gunicorn listening at: http://0.0.0.0:PORT
```

### **Metrics Available**
- CPU usage
- Memory usage
- Request counts
- Response times

---

## ‚öôÔ∏è Scaling & Performance

### **Render Plans**

| Plan | Price | Resources | Best For |
|------|-------|-----------|----------|
| **Free** | $0/month | Limited | Testing/Development |
| **Starter** | $7/month | 512MB RAM | Small production apps |
| **Standard** | $25/month | 1GB RAM | Medium production apps |

### **Optimize Performance**
```yaml
# In render.yaml, adjust resources:
services:
  - type: web
    plan: starter  # or standard for more resources
```

---

## üêõ Troubleshooting

### **Application Won't Start**

**Check Logs:**
```
Render Dashboard ‚Üí Your Service ‚Üí Logs
```

**Common Issues:**

1. **Missing Environment Variables**
   ```
   Error: SECRET_KEY not set
   ```
   **Fix:** Add `SECRET_KEY` in Environment tab

2. **Database Connection Failed**
   ```
   Error: could not connect to server
   ```
   **Fix:** Ensure PostgreSQL service is running and linked

3. **Module Not Found**
   ```
   ModuleNotFoundError: No module named 'gunicorn'
   ```
   **Fix:** Check `requirements.txt` includes all dependencies

4. **Build Command Failed**
   ```
   npm: command not found
   ```
   **Fix:** Ensure build command is: `npm install && npm run build`

### **500 Internal Server Error**

1. Check application logs for Python errors
2. Verify all environment variables are set
3. Check database connection
4. Ensure PostgreSQL service is healthy

### **Database Not Persisting Data**

1. Confirm PostgreSQL service is added
2. Check `DATABASE_URL` is set correctly
3. Verify tables are created (check logs for `db.create_all()`)

### **File Uploads Not Working**

1. Add a Render Disk for persistent storage
2. Or implement cloud storage (S3, Cloudinary)
3. Check `UPLOAD_FOLDER` environment variable

### **Slow Performance**

1. Check Render plan limits
2. Upgrade to higher plan if needed
3. Add caching (Redis)
4. Optimize database queries

---

## üí∞ Pricing

### **Render Plans**

| Plan | Price | Resources | Best For |
|------|-------|-----------|----------|
| **Free** | $0/month | 750 hours/month | Testing |
| **Starter** | $7/month | Always on | Personal projects |
| **Standard** | $25/month | More resources | Production apps |

**What you need:**
- Flask App service: $7-25/month
- PostgreSQL: $7/month
- **Total: ~$14-32/month** for a production app

---

## üîÑ CI/CD & Auto Deployment

Render automatically deploys when you push to GitHub:

1. **Push code to GitHub:**
   ```bash
   git add .
   git commit -m "Update feature"
   git push origin main
   ```

2. **Render automatically:**
   - Detects the push
   - Rebuilds the application
   - Runs tests (if configured)
   - Deploys the new version
   - Zero-downtime deployment

### **Configure Auto-Deploy**
1. Go to **"Settings"** ‚Üí **"Build & Deploy"**
2. Enable **"Auto Deploy"**
3. Choose branch: **`main`**

---

## üåê Custom Domain

### **Add Your Own Domain**

1. Go to **"Settings"** ‚Üí **"Custom Domains"**
2. Click **"Add Custom Domain"**
3. Enter your domain: `app.yourdomain.com`
4. Add CNAME record to your DNS:
   ```
   CNAME: app.yourdomain.com ‚Üí your-app.onrender.com
   ```
5. Render automatically provisions SSL certificate

---

## üîí Security Best Practices

### **Environment Variables**
- ‚úÖ Never commit `.env` files
- ‚úÖ Use Render's Environment tab
- ‚úÖ Generate strong secret keys (32+ characters)
- ‚úÖ Rotate keys periodically

### **Database**
- ‚úÖ Render PostgreSQL uses SSL by default
- ‚úÖ Automatic backups enabled
- ‚úÖ No public exposure (internal network only)

### **API Keys**
- ‚úÖ Store OpenAI API key in environment variables
- ‚úÖ Monitor usage at https://platform.openai.com
- ‚úÖ Set spending limits in OpenAI dashboard

### **CORS Configuration**
Update `extensions.py` for production:
```python
cors = CORS(resources={
    r"/api/*": {
        "origins": ["https://your-domain.com"],
        "methods": ["GET", "POST", "PUT", "DELETE"],
        "allow_headers": ["Content-Type", "Authorization"]
    }
})
```

---

## üìà Next Steps

After successful deployment:

### **1. Test All Features**
- ‚úÖ User registration and login
- ‚úÖ Project creation
- ‚úÖ File uploads
- ‚úÖ PDF annotations
- ‚úÖ AI Q&A (if OpenAI API key set)
- ‚úÖ Team discussions

### **2. Configure Monitoring**
- Set up error tracking (Sentry)
- Enable uptime monitoring
- Configure alerts

### **3. Optimize for Production**
- Add Redis for caching
- Implement CDN for static files
- Add rate limiting
- Set up backup strategy

### **4. Documentation**
- Update README with your Render URL
- Document API endpoints
- Create user guide

---

## üÜò Support Resources

### **Render Documentation**
- Docs: https://render.com/docs
- Status: https://status.render.com
- Community: https://community.render.com

### **Your Application**
- Repository: Your GitHub repo
- Issues: GitHub Issues

### **Common Commands**

```bash
# Install Render CLI
npm install -g @render/cli

# Login to Render
render login

# View logs
render logs

# Run command in Render environment
render run python manage.py

# Open dashboard
render open
```

---

## ‚úÖ Deployment Checklist

Before going live, verify:

- [ ] PostgreSQL database added and connected
- [ ] All environment variables set
- [ ] SECRET_KEY and JWT_SECRET_KEY are strong and unique
- [ ] FLASK_ENV set to "production"
- [ ] OpenAI API key added (if using AI features)
- [ ] Custom domain configured (optional)
- [ ] SSL certificate active
- [ ] Health check endpoint working
- [ ] Demo user can login
- [ ] File uploads working (with disk or cloud storage)
- [ ] Logs show no errors
- [ ] All features tested in production
- [ ] Backup strategy in place

---

## üéâ You're Live!

Your AI Interior Design Platform is now running on Render!

**Share your app:**
```
https://your-app-name.onrender.com
```

**Monitor your app:**
```
Render Dashboard ‚Üí Your Service ‚Üí Logs
```

**Scale your app:**
```
Render Dashboard ‚Üí Settings ‚Üí Plan
```

---

**Need help?** Check the logs, consult Render docs, or open an issue on GitHub!

**Happy Deploying! üöÄ**
